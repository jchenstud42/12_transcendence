datasource db
{
	provider = "sqlite"
	url			= env("DATABASE_URL")
}

generator client
{
	provider = "prisma-client-js"
}

enum UserStatus
{
	OFFLINE
	ONLINE
	IN_GAME
	PENDING
}

model User
{
	id 			Int 		@id @default(autoincrement())
	username	String		@unique
	email		String		@unique
	password	String
	status		UserStatus	@default(OFFLINE)
	avatar		String?
	createdAt	DateTime	@default(now())

	// Relations
	friendsInitiated	Friend[]	@relation("UserFriends")
	friendsReceived		Friend[]	@relation("FriendUser")
	matchesAsPlayer1	Match[]		@relation("Player1")
	matchesAsPlayer2	Match[]		@relation("Player2")
}

model Friend
{
	id 			Int 		@id @default(autoincrement())
	status		UserStatus		@default(PENDING)
	createdAt	DateTime	@default(now())

	userId		String
	friendId	String
	user		User		@relation("UserFriends", fields: [userId], references:	[id])
	friend		User		@relation("FriendUser", fields: [friendId], references:	[id])

	@@unique([userId, friendId])
}

model Match
{
	id 			Int 		@id @default(autoincrement())
	score1		Int
	score2		Int
	date		DateTime	@default(now())

	player1Id	String
	player2Id	String
	player1		User		@relation("Player1", fields: [player1Id], references: [id])
	player2		User		@relation("Player2", fields: [player2Id], references: [id])

	winnerId	String
	winner		User?		@relation("Winner", fields: [winnerId], references: [id])
}
